{% extends "base.html" %}
{% block page_title %}Scheduler{% endblock %}
{% block content %}
<section class="hero card glass"><div><p class="eyebrow">Scheduler</p><h1>Service Scheduler Pipeline</h1></div></section>
<section class="card">
  {% if ctx.membership.role in ["owner", "admin"] %}
  <form method="post" action="/service-jobs?tenant_id={{ ctx.tenant.id }}" class="inline-form board-form">
    <input class="input" required type="text" name="title" placeholder="Service request title" />
    <input class="input" type="text" name="service_type" placeholder="Service type" />
    <input class="input" type="date" name="scheduled_for" />
    <select class="select" name="client_id"><option value="">No client</option>{% for client in clients %}<option value="{{ client.id }}">{{ client.name }}</option>{% endfor %}</select>
    <button class="btn" type="submit">Add request</button>
  </form>
  {% endif %}
  <p class="subtle">Drag service cards between stages to update pipeline status in one move.</p>
  <div class="kanban four" data-board="scheduler">
    <div class="lane drop-lane" data-service-stage="intake">
      <h3>Intake</h3>
      {% for item in service_intake %}
      <div class="task-card dnd-card" data-service-id="{{ item.id }}" draggable="true">
        <strong>{{ item.title }}</strong>
        <p class="subtle">{{ item.service_type|capitalize }}{% if item.scheduled_for %} 路 {{ item.scheduled_for }}{% endif %}</p>
      </div>
      {% else %}<p class="subtle lane-empty">No items</p>{% endfor %}
    </div>
    <div class="lane drop-lane" data-service-stage="scheduled">
      <h3>Scheduled</h3>
      {% for item in service_scheduled %}
      <div class="task-card dnd-card" data-service-id="{{ item.id }}" draggable="true">
        <strong>{{ item.title }}</strong>
        <p class="subtle">{{ item.service_type|capitalize }}{% if item.scheduled_for %} 路 {{ item.scheduled_for }}{% endif %}</p>
      </div>
      {% else %}<p class="subtle lane-empty">No items</p>{% endfor %}
    </div>
    <div class="lane drop-lane" data-service-stage="in_service">
      <h3>In Service</h3>
      {% for item in service_in_service %}
      <div class="task-card dnd-card" data-service-id="{{ item.id }}" draggable="true">
        <strong>{{ item.title }}</strong>
        <p class="subtle">{{ item.service_type|capitalize }}{% if item.scheduled_for %} 路 {{ item.scheduled_for }}{% endif %}</p>
      </div>
      {% else %}<p class="subtle lane-empty">No items</p>{% endfor %}
    </div>
    <div class="lane drop-lane" data-service-stage="completed">
      <h3>Completed</h3>
      {% for item in service_completed %}
      <div class="task-card dnd-card" data-service-id="{{ item.id }}" draggable="true">
        <strong>{{ item.title }}</strong>
        <p class="subtle">{{ item.service_type|capitalize }}{% if item.scheduled_for %} 路 {{ item.scheduled_for }}{% endif %}</p>
      </div>
      {% else %}<p class="subtle lane-empty">No items</p>{% endfor %}
    </div>
  </div>
</section>
{% endblock %}
