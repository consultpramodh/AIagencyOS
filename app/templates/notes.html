{% extends "base.html" %}
{% block page_title %}Notes{% endblock %}
{% block content %}
<section class="hero card glass"><div><p class="eyebrow">Notes</p><h1>Notes & Docs</h1></div></section>
<section class="card">
  {% if ctx.membership.role in ["owner", "admin"] %}
  <form method="post" action="/notes?tenant_id={{ ctx.tenant.id }}" class="stack">
    <input class="input" required type="text" name="title" placeholder="Document title" />
    <textarea class="input" name="body_markdown" rows="5" placeholder="# Meeting notes"></textarea>
    <div class="inline-form"><select class="select" name="project_id"><option value="">No project</option>{% for project in projects %}<option value="{{ project.id }}">{{ project.name }}</option>{% endfor %}</select><button class="btn" type="submit">Create note</button></div>
  </form>
  {% endif %}
  <div class="notes-list">
    {% for note in notes %}
    <article class="note-item">
      <h3>{{ note.title }}</h3>
      <pre>{{ note.body_markdown }}</pre>
      {% if attachments.get(note.id) %}
      <ul class="list">{% for attachment in attachments.get(note.id) %}<li><span>{{ attachment.original_name }}</span><a class="text-link" href="/attachments/{{ attachment.id }}/download?tenant_id={{ ctx.tenant.id }}">Download</a></li>{% endfor %}</ul>
      {% endif %}
      {% if ctx.membership.role in ["owner", "admin"] %}
      <form method="post" action="/notes/{{ note.id }}/update?tenant_id={{ ctx.tenant.id }}" class="stack note-form"><input class="input" required type="text" name="title" value="{{ note.title }}" /><textarea class="input" name="body_markdown" rows="4">{{ note.body_markdown }}</textarea><button class="btn btn-small" type="submit">Save</button></form>
      <form method="post" action="/notes/{{ note.id }}/attachments?tenant_id={{ ctx.tenant.id }}" enctype="multipart/form-data" class="inline-form"><input class="input" type="file" name="file" required /><button class="btn btn-small" type="submit">Upload</button></form>
      {% endif %}
    </article>
    {% else %}<p class="subtle">No notes yet</p>{% endfor %}
  </div>
</section>
{% endblock %}
